


# Raytracing a polygon mesh {#Raytracing-a-polygon-mesh}

```julia
using Krang
import GLMakie as GLMk
using GeometryBasics
using FileIO

metric = Krang.Kerr(0.99) # Kerr metric with a spin of 0.99
θo = 90 / 180 * π # Inclination angle of the observer
ρmax = 12.0 # Horizontal and Vertical extent of the screen
sze = 100 # Resolution of the screen is sze x sze

camera = Krang.SlowLightIntensityCamera(metric, θo, -ρmax, ρmax, -ρmax, ρmax, sze)
```


```ansi
SlowLightIntensityCamera{Float64, Matrix{Krang.SlowLightIntensityPixel{Float64}}}(Kerr{Float64}(1.0, 0.99), Krang.SlowLightIntensityScreen{Float64, Matrix{Krang.SlowLightIntensityPixel{Float64}}}((-12.0, 12.0), (-12.0, 12.0), Krang.SlowLightIntensityPixel{Float64}[Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-12.0, -12.0), (-17.811393086775468 - 3.6622313808008166e-17im, 0.3222351305493678 + 1.2554506945771609e-15im, 1.5419781346644301 - 1.2759301128716357e-15im, 15.947179821561672 + 5.7101732102483e-17im), 0.10027124120610698, 0.20054248241221395, 3.194826534165685, 7.300113496657746, -2.1933076951002244, -13.176345710296971, -0.2458426274138147, -0.14259682706530025, (0.0, 0.18519854383797518), (5.102694996447269e-18, 0.2621141790545371), (6.377347282384589e-51, 0.04636852782576966), 1.5707963267948966, 144.0, 12.0) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-12.0, -11.757575757575758), (-17.638476027306 - 2.5119566969130612e-17im, 0.31478822909250326 + 8.454330522229745e-16im, 1.5466851612338912 - 8.596354078342111e-16im, 15.777002636979606 + 3.932192258036724e-17im), 0.10137241458100651, 0.20274482916201303, 3.1673559003096705, 7.2000507490709795, -2.184346461884292, -13.041084964244149, -0.24555855687453623, -0.1430989101434273, (0.0, 0.18708517002259345), (5.207905202559688e-18, 0.2621238807781972), (6.508838978928728e-51, 0.04588827118021304), 1.5707963267948966, 138.24058769513314, 12.0) … Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-12.0, 11.757575757575758), (-17.638476027306 - 2.5119566969130612e-17im, 0.31478822909250326 + 8.454330522229745e-16im, 1.5466851612338912 - 8.596354078342111e-16im, 15.777002636979606 + 3.932192258036724e-17im), 0.10137241458100651, 0.20274482916201303, 3.1673559003096705, 7.2000507490709795, -2.184346461884292, -13.041084964244149, -0.24555855687453623, -0.1430989101434273, (0.0, 0.18708517002259345), (5.207905202559688e-18, 0.2621238807781972), (6.508838978928728e-51, 0.04588827118021304), 1.5707963267948966, 138.24058769513314, 12.0) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-12.0, 12.0), (-17.811393086775468 - 3.6622313808008166e-17im, 0.3222351305493678 + 1.2554506945771609e-15im, 1.5419781346644301 - 1.2759301128716357e-15im, 15.947179821561672 + 5.7101732102483e-17im), 0.10027124120610698, 0.20054248241221395, 3.194826534165685, 7.300113496657746, -2.1933076951002244, -13.176345710296971, -0.2458426274138147, -0.14259682706530025, (0.0, 0.18519854383797518), (5.102694996447269e-18, 0.2621141790545371), (6.377347282384589e-51, 0.04636852782576966), 1.5707963267948966, 144.0, 12.0); Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-11.757575757575758, -12.0), (-17.640437321470174 - 2.4530065262927946e-17im, 0.3305713202666105 + 8.45498564627043e-16im, 1.534155704198172 - 8.593965268063113e-16im, 15.775710297005391 + 3.842802744219619e-17im), 0.10138231150381616, 0.20276462300763232, 3.247738126141635, 7.025903224603969, -2.182974372020287, -13.040841034908691, -0.25354899469824504, -0.14584785808244244, (0.0, 0.18707522107719274), (5.102694996447354e-18, 0.26752176320486765), (6.377347282384694e-51, 0.0477937218908365), 1.5707963267948966, 144.0, 11.757575757575758) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-11.757575757575758, -11.757575757575758), (-17.465724293757646 - 2.5252190636852947e-17im, 0.32306161221907637 + 8.542281192425115e-16im, 1.5388774673628065 - 8.68697217553463e-16im, 15.603785214175762 + 3.9721288947804355e-17im), 0.1025198562873458, 0.2050397125746916, 3.2192885013510093, 6.92595759259859, -2.173824128209073, -12.90416631878923, -0.2532463997130017, -0.14637960462641042, (0.0, 0.1890203905949582), (5.207905202559685e-18, 0.267531971424384), (6.508838978928727e-51, 0.047328338742632856), 1.5707963267948966, 138.24058769513314, 11.757575757575758) … Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-11.757575757575758, 11.757575757575758), (-17.465724293757646 - 2.5252190636852947e-17im, 0.32306161221907637 + 8.542281192425115e-16im, 1.5388774673628065 - 8.68697217553463e-16im, 15.603785214175762 + 3.9721288947804355e-17im), 0.1025198562873458, 0.2050397125746916, 3.2192885013510093, 6.92595759259859, -2.173824128209073, -12.90416631878923, -0.2532463997130017, -0.14637960462641042, (0.0, 0.1890203905949582), (5.207905202559685e-18, 0.267531971424384), (6.508838978928727e-51, 0.047328338742632856), 1.5707963267948966, 138.24058769513314, 11.757575757575758) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (-11.757575757575758, 12.0), (-17.640437321470174 - 2.4530065262927946e-17im, 0.3305713202666105 + 8.45498564627043e-16im, 1.534155704198172 - 8.593965268063113e-16im, 15.775710297005391 + 3.842802744219619e-17im), 0.10138231150381616, 0.20276462300763232, 3.247738126141635, 7.025903224603969, -2.182974372020287, -13.040841034908691, -0.25354899469824504, -0.14584785808244244, (0.0, 0.18707522107719274), (5.102694996447354e-18, 0.26752176320486765), (6.377347282384694e-51, 0.0477937218908365), 1.5707963267948966, 144.0, 11.757575757575758); … ; Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (11.757575757575758, -12.0), (-17.781479386402786 - 4.969222631444887e-17im, 0.26163540322435885 + 1.2663858277683034e-15im, 1.9482024385129888 - 1.3015057232471788e-15im, 15.57164154466544 + 8.48121217933244e-17im), 0.10315682935170056, 0.20631365870340113, -1.7925822621531566, 23.940178659201173, -2.206246964058812, -12.984004388451183, -0.1232986313179256, -0.09026306629032814, (0.0, 0.18707522107719274), (5.102694996447354e-18, 0.26752176320486765), (6.377347282384694e-51, 0.0477937218908365), 1.5707963267948966, 144.0, -11.757575757575758) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (11.757575757575758, -11.757575757575758), (-17.609506000215994 - 3.408011043629016e-17im, 0.25504723925106276 + 8.529391086302426e-16im, 1.959574258655218 - 8.774316195876013e-16im, 15.394884502309713 + 5.857262139364886e-17im), 0.10437921972968421, 0.20875843945936842, -1.77226720086441, 23.738179645752226, -2.1976301247423478, -12.845399588527231, -0.12290682768417777, -0.09028812537945839, (0.0, 0.1890203905949582), (5.207905202559685e-18, 0.267531971424384), (6.508838978928727e-51, 0.047328338742632856), 1.5707963267948966, 138.24058769513314, -11.757575757575758) … Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (11.757575757575758, 11.757575757575758), (-17.609506000215994 - 3.408011043629016e-17im, 0.25504723925106276 + 8.529391086302426e-16im, 1.959574258655218 - 8.774316195876013e-16im, 15.394884502309713 + 5.857262139364886e-17im), 0.10437921972968421, 0.20875843945936842, -1.77226720086441, 23.738179645752226, -2.1976301247423478, -12.845399588527231, -0.12290682768417777, -0.09028812537945839, (0.0, 0.1890203905949582), (5.207905202559685e-18, 0.267531971424384), (6.508838978928727e-51, 0.047328338742632856), 1.5707963267948966, 138.24058769513314, -11.757575757575758) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (11.757575757575758, 12.0), (-17.781479386402786 - 4.969222631444887e-17im, 0.26163540322435885 + 1.2663858277683034e-15im, 1.9482024385129888 - 1.3015057232471788e-15im, 15.57164154466544 + 8.48121217933244e-17im), 0.10315682935170056, 0.20631365870340113, -1.7925822621531566, 23.940178659201173, -2.206246964058812, -12.984004388451183, -0.1232986313179256, -0.09026306629032814, (0.0, 0.18707522107719274), (5.102694996447354e-18, 0.26752176320486765), (6.377347282384694e-51, 0.0477937218908365), 1.5707963267948966, 144.0, -11.757575757575758); Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (12.0, -12.0), (-17.952668704272526 - 3.2765377669138564e-17im, 0.25561836422800255 + 8.357723444881215e-16im, 1.9534780245174446 - 8.5861149839102065e-16im, 15.743572315527079 + 5.560453157203775e-17im), 0.10200223184282542, 0.20400446368565084, -1.780959010044301, 24.074212791955848, -2.2160995622595325, -13.120178155147615, -0.12114996854080352, -0.08885191326996254, (0.0, 0.18519854383797518), (5.102694996447269e-18, 0.2621141790545371), (6.377347282384589e-51, 0.04636852782576966), 1.5707963267948966, 144.0, -12.0) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (12.0, -11.757575757575758), (-17.7824416240653 - 5.053263097256706e-17im, 0.24910086974177226 + 1.2662896490723065e-15im, 1.9646605627738465 - 1.3020934455761203e-15im, 15.568680191549678 + 8.63364274763809e-17im), 0.1031843296645366, 0.2063686593290732, -1.7612081190302535, 23.87531612119135, -2.207649485347096, -12.983051556211219, -0.12077580788725267, -0.08887616601108743, (0.0, 0.18708517002259345), (5.207905202559688e-18, 0.2621238807781972), (6.508838978928728e-51, 0.04588827118021304), 1.5707963267948966, 138.24058769513314, -12.0) … Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (12.0, 11.757575757575758), (-17.7824416240653 - 5.053263097256706e-17im, 0.24910086974177226 + 1.2662896490723065e-15im, 1.9646605627738465 - 1.3020934455761203e-15im, 15.568680191549678 + 8.63364274763809e-17im), 0.1031843296645366, 0.2063686593290732, -1.7612081190302535, 23.87531612119135, -2.207649485347096, -12.983051556211219, -0.12077580788725267, -0.08887616601108743, (0.0, 0.18708517002259345), (5.207905202559688e-18, 0.2621238807781972), (6.508838978928728e-51, 0.04588827118021304), 1.5707963267948966, 138.24058769513314, -12.0) Krang.SlowLightIntensityPixel{Float64}(Kerr{Float64}(1.0, 0.99), (12.0, 12.0), (-17.952668704272526 - 3.2765377669138564e-17im, 0.25561836422800255 + 8.357723444881215e-16im, 1.9534780245174446 - 8.5861149839102065e-16im, 15.743572315527079 + 5.560453157203775e-17im), 0.10200223184282542, 0.20400446368565084, -1.780959010044301, 24.074212791955848, -2.2160995622595325, -13.120178155147615, -0.12114996854080352, -0.08885191326996254, (0.0, 0.18519854383797518), (5.102694996447269e-18, 0.2621141790545371), (6.377347282384589e-51, 0.04636852782576966), 1.5707963267948966, 144.0, -12.0)]), (Inf, 1.5707963267948966))
```


Import external mesh

```julia
bunny_mesh = translate(
    rotate(
        scale(
            load(
                download(
                    "https://graphics.stanford.edu/~mdfisher/Data/Meshes/bunny.obj",
                    "bunny.obj",
                ),
            ),
            100,
        ),
        π / 2,
        1.0,
        0.0,
        0.0,
    ),
    2.0,
    10.0,
    -10.0,
);
```


Ray trace the mesh embedded in the Kerr space time. The emission picked up by a ray will be the sum of all the intersections of the ray with the mesh The mesh is embedded in the space-time by assuming the world coordinates of the mesh is the same as the Boyer-Lindquist coordinates of the space time. The ray tracing is done by scanning over the image one line at a time

Let us now ray trace the image to see what the mesh looks like from the observer&#39;s perspective.

```julia
intersections = raytrace(camera, bunny_mesh);
```


And plot the image with GLMakie,

```julia
fig = GLMk.Figure()
ax = GLMk.Axis(fig[1, 1], aspect = 1)
GLMk.heatmap!(ax, intersections, colormap = :afmhot);

save("mesh_geometry_example.png", fig);
```



![](mesh_geometry_example.png)


Below is a short plotting routine that generates a video showing the scene from three different perspectives, and live renders the image.

```julia
fig = GLMk.Figure()
ax1 = GLMk.Axis3(
    fig[1, 1],
    aspect = (1, 1, 1),
    title = "Top view of scene",
    elevation = π / 2,
    azimuth = π,
)
ax2 = GLMk.Axis3(
    fig[1, 2],
    aspect = (1, 1, 1),
    title = "Side view of scene",
    elevation = 0.0,
    azimuth = 3π / 2,
)
ax3 = GLMk.Axis3(fig[2, 1], aspect = (1, 1, 1), title = "Isometric view of scene")

ax = GLMk.Axis(fig[2, 2], aspect = 1, title = "Heatmap of ray intersections with mesh")

for a in [ax1, ax2, ax3]
    GLMk.xlims!(a, (-20, 20))
    GLMk.ylims!(a, (-20, 20))
    GLMk.zlims!(a, (-20, 20))
    GLMk.hidedecorations!(a)
end

GLMk.hidedecorations!(ax)
sphere = GLMk.Sphere(GLMk.Point(0.0, 0.0, 0.0), horizon(metric)) # Sphere to represent black hole
lines_to_plot = Krang.generate_ray.(camera.screen.pixels, 100) # 100 is the number of steps to take along the ray

img = zeros(sze, sze)
recording = GLMk.record(fig, "mesh.mp4", 1:sze*sze, framerate = 120) do i
    line = lines_to_plot[i]

    img[i] = intersections[i]

    GLMk.empty!(ax)
    GLMk.empty!(ax1)
    GLMk.empty!(ax2)
    GLMk.empty!(ax3)

    for a in [ax1, ax2, ax3]
        GLMk.mesh!(
            a,
            bunny_mesh,
            color = [
                parse(GLMk.Colorant, "rgba(0%, 50%, 70%,1.0)") for
                tri in bunny_mesh.position
            ],
            colormap = :blues,
            transparency = true,
        )
        GLMk.mesh!(a, sphere, color = :black)
    end

    cart_line = map(
        x -> Krang.boyer_lindquist_to_quasi_cartesian_kerr_schild_fast_light(
            metric,
            x.rs,
            x.θs,
            x.ϕs,
        ),
        line,
    )
    GLMk.lines!(ax3, cart_line, color = :red)
    GLMk.heatmap!(ax, img, colormap = :afmhot, colorrange = (0, 8))
end
```


```ansi
"mesh.mp4"
```

<video loop muted playsinline controls src="./mesh.mp4" />



---


_This page was generated using [Literate.jl](https://github.com/fredrikekre/Literate.jl)._
